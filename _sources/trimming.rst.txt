HPL
===

Node testing procedure is usually done if a component has been moved around on a
blade for hardware diagnostic purposes or general diagnostics. HPL ( High
Performance LINPACK ( Linear Algebra PACKage ) ) benchmarks are a measure of a
system's floating-point computing power. The equation to calculate the theoretical
peak floating-point performance is:

.. math::

  GFLOPS = \text{CPU GHz} \times \text{cores} \times
  \text{instruction per cycle} \times \text{sockets}

Thus, based on the above equation, the theoretical peak performance of a Shaheen-II Intel
Haswell compute node is: :math:`1177.6 \text{ GFLOPS }`. However, the sustained
LINPACK performance of a Shaheen-II compute node is between: :math:`935-955 \text{ GFLOPS ( } \sim80\% \text{ of the peak performance ) }`.

..
  Get the LINKPACK binary for Shaheen-II and a SLURM script at ``_.

Request reservation
-------------------

Update the KSL RT ticket requesting for reservation on the nodes to be tested.
Make sure the nodes are not in a drained state. If they are in a drained state
asked for the nodes to be resumed in the KSL RT ticket.

.. code-block:: console

  $ NID=nid0[5100-5103,5820-5823]
  $ echo; scontrol show node $NID | egrep "NodeName|State" | awk '{print $1}' | paste -s -d' \n'; echo

  NodeName=nid05100 State=ALLOCATED
  NodeName=nid05101 State=ALLOCATED
  NodeName=nid05102 State=ALLOCATED
  NodeName=nid05103 State=ALLOCATED
  NodeName=nid05820 State=ALLOCATED
  NodeName=nid05821 State=ALLOCATED
  NodeName=nid05822 State=ALLOCATED
  NodeName=nid05823 State=ALLOCATED

  $ echo; squeue -w $NID; echo

    JOBID       USER ACCOUNT           NAME  ST REASON    START_TIME                TIME  TIME_LEFT NODES

  $ echo; scontrol show res rt29677; echo

  ReservationName=rt29677 StartTime=2020-02-27T12:31:52 EndTime=2020-02-28T00:31:52 Duration=12:00:00
     Nodes=nid0[5100-5103,5820-5823] NodeCnt=8 CoreCnt=256 Features=(null) PartitionName=(null) Flags=SPEC_NODES
     TRES=cpu=512
     Users=(null) Groups=(null) Accounts=v1003,k00, k01 Licenses=(null) State=ACTIVE BurstBuffer=(null) Watts=n/a
     MaxStartDelay=(null)

LINPACK SLURM script
--------------------

.. code-block:: console

  #!/bin/bash

  #SBATCH -N 1
  #SBATCH -t 0:50:00
  #SBATCH --output=linpack-%A_%a_%N.out
  #SBATCH --err=linpack-%A_%a_%N.err
  #SBATCH --ntasks=1
  #SBATCH --cpus-per-task=32
  #SBATCH --sockets-per-node=2
  #SBATCH --cores-per-socket=16
  #SBATCH --threads-per-core=1
  #SBATCH --hint=nomultithread
  #SBATCH --account=v1003
  #SBATCH --reservation=rt29677

  export OMP_NUM_THREADS=32
  export KMP_AFFINITY=nowarnings,scatter,1,0,granularity=fine

  ./xlinpack_xeon64 lininput_xeon64

Lunching multiple LINPACK script
--------------------------------

.. code-block:: console

  for i in {5100..5103} {5820..5823}
  do
    sbatch -w nid0$i linpak_slurm.sh
  done
